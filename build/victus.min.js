// victus | (c) 2022 sporeball & contributors | MIT license
(()=>{let t,e,s,o,i,l,n,h,a,c,r,d=Math.PI,u=Object;class y{constructor(t,e,s,o,i){n=this,n.x=t,n.y=e,n.w=s,n.h=o,n.xv=n.yv=n.rotation=0,n.ax=n.w/2,n.ay=n.h/2,n.hidden=0,n.set(i)}moveTo(t,e){this.x=t,this.y=e}moveBy(t,e){this.x+=t,this.y+=e}anchor(t,e){this.ax=t,this.ay=e}hide(){this.hidden=1}show(){this.hidden=0}set(t){u.assign(this,t)}clone(t){return h=u.assign(u.create(this),this),h.set(t),h}draw(){n=this,n.moveBy(n.xv/60,n.yv/60),a=n.x+n.ax,c=n.y+n.ay,e.sv(),e.ta(a,c),e.rt(n.rotation*(d/180)),e.ta(-a,-c),n.hidden||n._(),e.re()}}class x extends y{constructor(t,e,s,o,i,l){super(t,e,s,o,l),this.col=i}_(){e.fillStyle=n.col,e.fc(n.x,n.y,n.w,n.h)}}i={},onkeydown=onkeyup=t=>{i[t.key]=t.type[5]},l={x:0,y:0,click:0,held:0},onmousemove=t=>{l.x=t.pageX,l.y=t.pageY},onmousedown=t=>{0==t.button&&(l.held||(l.click=1),l.held=1)},onmouseup=t=>{0==t.button&&(l.held=0)},victus={setup:i=>{for(r in t=this[i.id],t.style.background=i.color||"#fff",e=t.getContext`2d`,victus.ctx=e,e)e[r[0]+(r[6]||r[2])]=e[r];s=t.width=i.w,o=t.height=i.h},Rect:x,Ellipse:class extends x{constructor(t,e,s,o,i,l){super(t,e,s,o,i,l)}_(){e.fillStyle=n.col,e.ba(),e.ee(n.x,n.y,n.w/2,n.h/2,0,0,7),e.ca(),e.fl()}},Sprite:class extends y{constructor(t,e,s,o,i,l){super(e,s,o,i,l),(this.d=new Image).src=t}_(){e.da(n.d,n.x,n.y,n.w,n.h)}},Text:class extends y{constructor(t,e,s,o=16,i="#000",l="Arial",h="left"){super(e,s),n=this,n.str=t,n.size=o,n.col=i,n.font=l,n.align=h}_(){e.fillStyle=n.col,e.font=n.size+"px "+n.font,e.textAlign=n.align,e.fx(n.str,n.x,n.y)}},Sound:class{constructor(t,e,s=0){n=this,n.vol=e,(n.d=new Audio(t)).loop=s}reset(){this.d.currentTime=0}play(){n=this,n.d.volume=n.vol,n.d.play()}pause(){this.d.pause()}},keys:i,mouse:l,clear:()=>{t.width=s}}})();